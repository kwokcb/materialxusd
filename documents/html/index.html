<!-- HTML header for doxygen 1.12.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MaterialXUSD: MaterialX USD Utilities</title>
<link rel="icon" href="toon_sphere.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<!-- Font Awesome CDN -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="MX_LAB.svg" style="width: 48px"/></td>
  <td id="projectalign">
   <div id="projectname">MaterialXUSD<span id="projectnumber">&#160;0.0.1</span>
   </div>
   <div id="projectbrief">Utilities for using MaterialX with USD</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('index.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">MaterialX USD Utilities </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__d_1_2_work_2materialx_2materialxusd_2_r_e_a_d_m_e"></a></p>
<p>This is a Github <a href="https://github.com/kwokcb/materialxusd">repository</a> of utilities related to MaterialX and USD.</p>
<p>This can be hooked into the larger interoperability picture with glTF / MaterialX and USD as shown in the example below:</p>
<p><img src="./documents/results/usd_gltf_mtlx_desk_web.png" alt="" width="100%" class="inline"/> <sub>Figure: MaterialX material downloaded from AMD GPU library. Converted to USD and displayed in <code>usdview</code> (top left), converted to glTF and display in ThreeJS editor (top right). Display in MaterialX Viewer (bottom left), and Web editor (bottom right)</sub></p>
<p>Some initial utilities are provided with more coming on-line as the site / requirements progress.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Available Components</h2>
<ul>
<li><p class="startli"><code><a class="el" href="mtlx2usd_8py_source.html">mtlx2usd.py</a></code> : Utility which takes a MaterialX document and creates a corresponding USD document with scene geometry, lights, and camera.</p>
<p class="startli">The main intent is currently to be able to consume documents from the MaterialX render test suite but any MaterialX file can be used as input.</p>
<p class="startli">Options Include:</p><ul>
<li>Preprocess the MaterialX file to attempt to produce valid USD shading network (See Support Utilities)</li>
<li>Input geometry (USD file)</li>
<li>Input camera (USD file)</li>
<li>Skydome like (A latlong HDR file)</li>
<li>Perform USD validation</li>
<li>Export just the materials to a USD file.</li>
<li>Render the corresponding USD file. This uses <code>usdrecord</code> currently.</li>
<li>Misc options for output for test suite compatibility:<ul>
<li>Use material name for file name</li>
<li>Create in subfolder with name being the input MaterialX name</li>
</ul>
</li>
</ul>
</li>
<li>Preprocessing Utilities:<ul>
<li><code><a class="el" href="preprocess__mtlx_8py_source.html">preprocess_mtlx.py</a></code> : Tries to preprocess a MaterialX document so that it considered valid by USD. Currently this includes logic to:<ul>
<li>Encapsulate top level nodes in a MaterialX document into a nodegraph. Connections are preserved.</li>
<li>Resolve any implicit geometry stream bindings on <code>inputs</code> and make them explicit by adding geometric stream nodes and binding them to any inputs with implicit bindings. Note that this requires loading in the standard library to get node definitions.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md3"></a>
Installation and Usage</h2>
<p>Install from the root folder:</p>
<div class="fragment"><div class="line">pip install .</div>
</div><!-- fragment --><p>Run using the <code>materialxusd</code> command. Currently there are two commands for:</p><ul>
<li>MaterialX to USD conversion which can be run using</li>
</ul>
<div class="fragment"><div class="line">materialxusd m2u</div>
</div><!-- fragment --><p> and preprocessing MaterialX documents which can be run using</p>
<div class="fragment"><div class="line">materialxusd pmtlx</div>
</div><!-- fragment --><p>The <code>tests</code> folder has a script with some command line calls to process an examples subfolder (<code>run_examples.sh</code>)</p>
<div class="fragment"><div class="line">materialxusd m2u -pp -v -f -sf -mn -r -m ./examples/standard_surface_carpaint.sphere.mtlx</div>
<div class="line">materialxusd m2u -pp -v -sf -mn -r -m ./examples/standard_surface_marble_solid.mtlx</div>
<div class="line">materialxusd m2u -pp -v -sf -mn -r -m ./examples/linepattern.mtlx</div>
<div class="line">materialxusd pmtlx ./examples/linepattern.mtlx # Processing</div>
<div class="line">materialxusd m2u -pp -v -sf -mn -r -m ./examples/linepattern_converted.mtlx</div>
</div><!-- fragment --><p>Some rendering of resulting USD files are shown below:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter"></th><th class="markdownTableHeadCenter"></th><th class="markdownTableHeadCenter"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><img src="https://raw.githubusercontent.com/kwokcb/materialxusd/refs/heads/main/tests/examples/linepattern/test_crosshatch_glslfx.png" alt="" width="100%" class="inline"/>Line Pattern   </td><td class="markdownTableBodyCenter"><img src="https://raw.githubusercontent.com/kwokcb/materialxusd/refs/heads/main/tests/examples/standard_surface_marble_solid/Marble_3D_glslfx.png" alt="" width="100%" class="inline"/>Marble   </td><td class="markdownTableBodyCenter"><img src="https://raw.githubusercontent.com/kwokcb/materialxusd/refs/heads/main/tests/examples/standard_surface_carpaint.sphere/Car_Paint_glslfx.png" alt="" width="100%" class="inline"/>Car Paint   </td></tr>
</table>
<p>There is additionaly a sample script process a snapshot of the MaterialX test suite (<code>render_rts.sh</code>). The runs the script commands directly as an example.</p>
<div class="fragment"><div class="line">folders=(</div>
<div class="line">    &quot;./resources/Materials/Examples&quot;</div>
<div class="line">    &quot;./resources/Materials/TestSuite/stdlib/convolution&quot;</div>
<div class="line">    &quot;./resources/Materials/TestSuite/stdlib/color_management&quot;</div>
<div class="line">    &quot;./resources/Materials/TestSuite/stdlib/procedural&quot;</div>
<div class="line">    &quot;./resources/Materials/TestSuite/pbrlib/surfaceshader&quot;</div>
<div class="line">    &quot;./resources/Materials/TestSuite/nprlib&quot;</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">for folder in &quot;${folders[@]}&quot;; do</div>
<div class="line">    echo &quot;Rendering $folder&quot;</div>
<div class="line">    python ../source/materialxusd/mtlx2usd.py -pp -mn -sf &quot;$folder&quot; -r -g ./data/sphere.usd -c ./data/camera_sphere.usda -e ./data/san_giuseppe_bridge.hdr</div>
<div class="line">done</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md4"></a>
Documentation</h2>
<p>Python API documentation can be found <a href="https://kwokcb.github.io/materialxusd/documents/html/index.html">here</a> </p>
<h1><a class="anchor" id="autotoc_md5"></a>
Acceptance</h1>
<p>An initial acceptance criteria is to be able to run MaterialX to USD conversion against the MaterialX render test suite files. Preliminary results are show below:</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Gallery of Example Materials</h2>
<p>glTF, Standard Surface, OpenUSD material renderings</p>
<p>&lt;iframe width="100%" height="500px" src="./tests/usd_mtlx_image_gallery.html"&gt;&lt;/iframe&gt; </p>
<h2><a class="anchor" id="autotoc_md7"></a>
Comparison: GLSL vs GLSLFX</h2>
<p>&lt;iframe width="100%" height="500px" src="./tests/glsl_vs_glslfx.html"&gt;&lt;/iframe&gt; </p>
<h2><a class="anchor" id="autotoc_md8"></a>
Comparison: GLSL vs OSL vs GLSLFX</h2>
<p>&lt;iframe width="100%" height="500px" src="./tests/glsl_vs_osl_glslfx.html"&gt;&lt;/iframe&gt;</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Design</h1>
<p><img src="./documents/images/design.png" alt="" width="100%" class="inline"/> </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.12.0-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li>
      <button class="btn btn-outline" type="button">
        <a href="https://github.com/kwokcb/materialxusd" target="_blank"><b class="fa-brands fa-github fa-1x"
            style="color: #ffffff;"></b></a>
      </button>
      <button class="btn btn-outline " type="button">
        <a href="https://www.linkedin.com/in/bernard-kwok/" target="_blank"><b class="fa-brands fa-linkedin-in fa-1x"
            style="color: #0082ca;"></b></a>
      </button>
    </li>
    <li><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
        <img alt="Creative Commons License" style="border-width:0; width: 48px"
          src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" />
    </li>
    </a>
    <li><a href="https://kwokcb.github.io/nanmuconsulting/" target="_blank" style="color: #333; text-decoration: none;">
        &copy; 2022-2025 NanMu Consulting.
      </a>
    </li>
  </ul>
</div>
<!-- Bootstrap JS (Optional) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
